server {
{{#addHTTP}}
    listen       80 {{{host}}};
    {{#ipv6}}
    listen       [::]:80 {{{host}}};
    {{/ipv6}}
{{/addHTTP}}

{{#addHTTPS}}
    listen       443 {{{host}}};
    {{#ipv6}}
    listen       [::]:443 {{{host}}};
    {{/ipv6}}
    ssl_certificate     {{{sslcert}}}
    ssl_certificate_key {{{sslkey}}}
{{/addHTTPS}}

    #proxy all requests to the UB backend
    location / {
        proxy_pass          {{{ubURL}}};
        proxy_set_header	Host    $host;
        proxy_set_header	{{remoteIPHeader}}  $realip_remote_addr;
        proxy_redirect      off;
    }
    #override client_max_body_size for setDocument endpoint
    location /setDocument {
        proxy_pass          {{{ubURL}}};
        proxy_set_header	Host    $host;
        proxy_set_header	{{remoteIPHeader}}  $realip_remote_addr;
        proxy_redirect      off;
        client_max_body_size    {{maxDocBodySize}};
    }
{{#sendFileHeader}}
    #application internal location for clientRequire, mdb, models etc
    location  /{{sendFileLocationRoot}}/app {
        internal;
        alias {{{appPath}}};
    }
    #BLOB stores internal locations
    {{#blobStores}}
    location  /{{sendFileLocationRoot}}/{{storeName}} {
        internal;
        alias {{{storePath}}};
    }
    {{/blobStores}}
{{/sendFileHeader}}
    #In case of load balancing upstream  in UB config httpServer.requestQueueLength should be decreased to 100
    # and recommended config is:
    #location / {
    #  proxy_pass              http://balancing_upstream;
    #  proxy_next_upstream     error timeout invalid_header;
    #  proxy_connect_timeout   2;
    #  proxy_set_header        Host            $host;
    #  proxy_set_header        X-Real-IP       $remote_addr;
    #  proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;
    #}
}