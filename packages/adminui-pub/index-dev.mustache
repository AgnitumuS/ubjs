<!doctype html>
<html>
    <head>
        <meta charset="utf-8"/>
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
	    <meta name="viewport" content="width=device-width, height=device-height, user-scalable=no">
        <title>{{uiSettings.adminUI.applicationTitle}}{{^uiSettings.adminUI.applicationTitle}}UnityBase {{/uiSettings.adminUI.applicationTitle}}(debug)</title>

        <link rel="shortcut icon" href="models/UB/img/UBLogo16.ico" />
        <link rel="icon" href="models/UB/img/UBLogo32.png" type="image/png" sizes="32x32" />
        <link rel="icon" href="models/UB/img/UBLogo48.png" type="image/png" sizes="48x48" />
        <link rel="icon" href="models/UB/img/UBLogo128.png" type="image/png" sizes="128x128" />

        <script type="text/javascript" nonce="{{cspNonce}}">
            window.UB_API_PATH = '{{{UB_API_PATH}}}';
            {{#uiSettings.adminUI.loginURL}}
                window.UB_LOGIN_URL = '{{{uiSettings.adminUI.loginURL}}}';
                window.redirectToLogin = function(reason) {
                    var url = UB_LOGIN_URL;
                    if (reason) {
                      url += (url.indexOf('?') === -1 ? '?' : '&') + 'reason=' + encodeURIComponent(reason);
                    }
                    url += (url.indexOf('?') === -1 ? '?' : '&') + 'returnUrl=' + encodeURIComponent(window.location.href);
                    window.location.href = url;
                }
                if ((window.localStorage.getItem('silenceKerberosLogin') !== 'true')
                  && window.localStorage.getItem(window.location.origin + window.UB_API_PATH + ':storedSession') == null)
                {
                    redirectToLogin();
                }
            {{/uiSettings.adminUI.loginURL}}
            window.__ubVersion = {
                _web: '{{staticVersion}}'
                {{#modelVersions}}
                , '{{modelName}}': '{{modelVersion}}'
                {{/modelVersions}}
            };
            window.__modelInit = [];
            {{#modelInitialization}}window.__modelInit.push('{{{dev}}}');{{/modelInitialization}}
            window.isDeveloperMode = true;
            window.IMAGE_PATH = 'res/mxGraph/images';
            window.mxLoadResources = false;
        </script>

        <link rel="stylesheet" type="text/css" href="{{#md5template}}models/adminui-pub/themes/{{uiSettings.adminUI.themeName}}/{{uiSettings.adminUI.themeName}}-all-debug.css{{/md5template}}" />
        <link rel="stylesheet" href="{{#md5}}models/adminui-pub/ub-css-all.css{{/md5}}"/>
        <link rel="stylesheet" href="clientRequire/font-awesome/css/font-awesome.css"/>
        <link rel="stylesheet" type="text/css" href="{{#md5template}}models/adminui-pub/themes/{{uiSettings.adminUI.themeName}}/ub.css{{/md5template}}" />

        <style>
            .ub-logo-h {
                position: absolute;
                top: 40%;
                left: 47%;
                color: rgb(100, 149, 237);
                font-size: 10em;
            }
            .x-body {
                margin: 0;
            }
        </style>

    </head>
    <body class="x-body">
        <div id="UBLogo" class="ub-logo-h">
	    <i class="fa fa-spinner fa-pulse"></i>
	    <span class="sr-only">Loading...</span>
        </div>
        <div id ="ubExtensionPageMessageObj"></div>

        <!-- add promises to IE-->
	    <script src="/clientRequire/es6-promise/dist/es6-promise.auto.js"></script>
        <!-- Promise unhandled rejection polyfill https://gist.github.com/rconnamacher/08c010eae3da8233d35500c9bbc8ba54 -->
        <script type="text/javascript" nonce="{{cspNonce}}">
            if (window.onunhandledrejection === undefined) {
                try {
                    // Feature check: native ES6 inheritance is required for the Unhandled Rejection
                    // polyfill because ES5 constructors cannot subclass builtins like Promise.
                    new Function ("()=>class{}");

                    // Feature check passed, polyfill will work
                    document.write('<script src="models/adminui-pub/unhandledrejection-polyfill.js" nonce="{{cspNonce}}"></' + 'script>');
                } catch (e) {}
            }
        </script>

        <script charset="utf-8" src="{{#md5}}models/adminui-pub/ext-all-debug-w-comments.js{{/md5}}"></script>
        <script src="{{#md5}}clientRequire/systemjs/dist/system.src.js{{/md5}}" type="text/javascript"></script>

        <script type="text/javascript" nonce="{{cspNonce}}">
          // set our baseURL reference path
            System.config({
                baseURL: '/clientRequire',
                defaultJSExtensions: false,
                map: {
                  css: 'systemjs-plugin-css/css.js',
                  vue: 'vue/dist/vue.common.js' // should be the same as in adminui-vue webpack config
                },
                meta: {
                  'tinymce*': { format: 'global' },
                  '*.css': { loader: 'css' },
                  '*.min.js':   { format: 'cjs' },
                  'codemirror/*.js': { format: 'cjs' },
                  'file-saver': { format: 'cjs' },
                  '*.def': {format: 'cjs'},
                  '*.vue': {
                    'loader': window.isDeveloperMode
                        ? '@unitybase/systemjs-plugin-vue-ub'
                        : '@unitybase/systemjs-plugin-vue-ub/dist/system_plugin_vue_ub.min.js'
                  }
                },
                packageConfigPaths: ['@unitybase/*/package.json', '@ub-e/*/package.json', '@ub-d/*/package.json']
            });

            //System.import('systemjs-hmr').then(function () {
            System.import('@unitybase/adminui-pub/hmr-client/system-hmr-ub').then(function (connectHMR) {
              connectHMR({ hmrServer: '{{{uiSettings.adminUI.hmrServerURL}}}' })
              return System.import('{{{adminUIModel.dev}}}')
            }).then(function(adminUI){
              return window.UB.inject('models/adminui-pub/themes/{{uiSettings.adminUI.themeName}}/{{uiSettings.adminUI.themeName}}-debug.js');
            });
        </script>
    </body>
</html>